# This file is generated by Nx.
#
# Build the docker image with `npx nx docker-build unoserver`.
# Tip: Modify "docker-build" options in project.json to change docker build args.
#
# Run the container with `docker run -p 3000:3000 -t philiplehmann/unoserver`.
FROM node:lts-bookworm

WORKDIR /app

RUN apt-get update; \
    apt-get install --no-install-recommends --yes python3-full python3-pip virtualenv unoconv libreoffice-java-common libreoffice-writer libreoffice-calc libreoffice-impress libreoffice-draw default-jre; \
    virtualenv --python=/usr/bin/python3 --system-site-packages virtenv; \
    virtenv/bin/pip install unoserver==2.0.1; \
    apt-get clean; \
    rm -rf /var/lib/apt/lists/*

ENV PATH="/app/virtenv/bin:${PATH}"

ENV HOST=0.0.0.0
ENV PORT=3000

COPY dist/apps/unoserver unoserver

# You can remove this install step if you build with `--bundle` option.
# The bundled output will include external dependencies.
RUN npm --prefix unoserver --omit=dev -f install

CMD [ "node", "unoserver" ]
