# This file is generated by Nx.
#
# Build the docker image with `npx nx docker-build puppeteer`.
# Tip: Modify "docker-build" options in project.json to change docker build args.
#
# Run the container with `docker run -p 3000:3000 -t puppeteer`.
FROM node:lts-bookworm-slim

ENV NODE_ENV=production

ENV PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true

ENV PUPPETEER_EXECUTABLE_PATH=/usr/bin/chromium

RUN apt-get update && \
    apt-get upgrade -y && \
    apt-get install -y libnss3 libatk1.0-0 libatk-bridge2.0-0 libcups2 libgbm1 libasound2 libpangocairo-1.0-0 libxss1 libgtk-3-0 \
                       wget gnupg \
                       fonts-ipafont-gothic fonts-wqy-zenhei fonts-thai-tlwg fonts-kacst fonts-freefont-ttf \
                       libgtk2.0-0 libdrm2 libxkbcommon0 \
                       chromium=123.0.6312.122-1~deb12u1

WORKDIR /app

ENV HOST=0.0.0.0
ENV PORT=3000

COPY dist/apps/puppeteer puppeteer

# You can remove this install step if you build with `--bundle` option.
# The bundled output will include external dependencies.
RUN npm --prefix puppeteer --omit=dev -f install

CMD [ "node", "puppeteer" ]
